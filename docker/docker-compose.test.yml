# Docker Compose for VPN testing with mock client (Full Integration Test)
# Usage: docker-compose -f docker-compose.yml -f docker-compose.test.yml up vpn-client-mock
# Note: VPN server and manager should already be running from docker-compose.yml
# 
# This uses host networking (network_mode: host) for full VPN functionality.
# Works best on Linux. On macOS Docker Desktop, use docker-compose.test-bridge.yml instead.

services:
  # Mock VPN Client - For testing VPN server with host networking
  vpn-client-mock:
    build:
      context: ..
      dockerfile: docker/Dockerfile.vpn-client-mock
    image: aviationwx-vpn-client-mock
    container_name: aviationwx-vpn-client-mock
    network_mode: host
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - VPN_SERVER_IP=127.0.0.1
      - VPN_CLIENT_LEFT_IP=127.0.0.1
      - CONNECTION_NAME=test_vpn
      - REMOTE_SUBNET=192.168.1.0/24
      - PSK=test-psk-for-local-testing-only
      - IKE_VERSION=2
      - ENCRYPTION=aes256gcm128
      - DH_GROUP=14
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "10"

