# AviationWX URL Rewriting (when Apache serves directly)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Note: HTTPS redirection is handled by Nginx in production

    # Handle subdomain requests (Host header preserved by reverse proxy)
    # Match subdomain pattern like kspb.aviationwx.org
    RewriteCond %{HTTP_HOST} ^([^\.]+)\.aviationwx\.org$ [NC]
    # Exclude www and bare domain
    RewriteCond %1 !^(www|aviationwx)$ [NC]
    # Rewrite to index.php with airport parameter
    RewriteRule ^(.*)$ index.php?airport=%1 [QSA,L]

    # Default to index.php for routing
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# Security - Protect sensitive files
<FilesMatch "^(airports\.json|\.git|\.gitignore|SECURITY\.md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Cache webcam images for better performance (nginx handles this in production)
# <FilesMatch "\.jpg$">
#     ExpiresActive On
#     ExpiresDefault "access plus 1 minute"
# </FilesMatch>

# PHP Settings
<IfModule mod_php.c>
    php_value upload_max_filesize 20M
    php_value post_max_size 20M
    php_value memory_limit 256M
    php_value max_execution_time 120
</IfModule>
